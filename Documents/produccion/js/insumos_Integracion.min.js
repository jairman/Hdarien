var prov=new Array();$(document).on("ready",function(){mensaje();regCantidad();fecha();$("#produccion_enviar").on("submit",validarFechas);$("#modificarOrdenP").on("submit",validarFechas2);
pedido();$("#modificarIntegracion").on("submit",validarCheck);$("#enviarcant").on("submit",function(){data=$("#enviarcant").serialize();$("#ventanaCantidad").dialog("close");
console.log(data);$.get("../controllers/controlador.php?PedirInsumos&"+data,llegadarealizarPedidoI);return false;});});function checkChildWindow(h,f){var b=h;
var a=f;var d=setTimeout(function(){checkChildWindow(b,a);},500);var c=false;try{if(h.closed||h.top==null){c=true;}}catch(g){c=true;}if(c){window.location.reload();
clearTimeout(d);}}function editarOrdPro(b){var a=window.open(b,"","width=900,height=400");window.win=a;checkChildWindow(a,function(){});a.moveTo(0,0);a.resizeTo(900,400);
}function mostrarPro(b){var a=window.open(b,"","width=900,height=400");window.win=a;overlay.show();a.moveTo(0,0);a.resizeTo(900,400);}function mensaje(){$(function(){var a=400;
$("#error").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});});}function pedido(){$(function(){var a=700;
$("#solicitud").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});});}function regCantidad(){$(function(){var a=400;
$("#ventanaCantidad").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});
});}function fecha(){var a=new Date();var c=new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
var b=new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");var a=new Date();$(".fecha").html(b[a.getDay()]+", "+a.getDate()+" de "+c[a.getMonth()]);
}function alertaAccion(a){$("#error").html("&nbsp;&nbsp;&nbsp;"+a).css("text-align","center");$("#error").prepend('<img id="theImg2" src="../../img/good.png" width="40" height="40"/> ');
$("span.ui-dialog-title").text("Información Importante").css("text-align","center");$("#error").dialog("open");setTimeout(function(){$("#error").dialog("close");
},2000);}function crearTabla(a,k,l,f,e,j,g,b,h,c,d){if(k!=undefined){elem=document.getElementById(k);if(elem==null){var m="";m+='<div><table id="'+k+'" width="90%"  border="1" cellspacing="0">';
m+="		<tr>";m+='		<td colspan="12" align="center" class="subtitle"><strong>'+k+"</strong></td>";m+="		</tr>";m+='		<tr class="stittle">';m+='		<td align="center" width="10%">Código</td>';
m+='      <td align="center" width="10%">Descripción</td>';m+='      <td align="center" width="5%">Unid. Medida</td>';m+='      <td align="center" width="5%">Proveedor</td>';
m+='      <td align="center" width="5%">Consumo</td>';m+='      <td align="center" width="5%">Costo consumo</td>';m+='      <td align="center" width="5%">Cantidad</td>';
m+='      <td align="center" width="5%">Costo Total</td>';m+='      <td align="center" width="5%">Inventario</td>';m+='      <td align="center" width="5%">Solicitar</td>';
m+='      <td align="center" width="5%">Descargar</td>';m+='      <td align="center" width="5%"></td>';$("#tablas").append(m);crearFila(a,k,l,f,e,j,g,b,h,c,d);
}else{crearFila(a,k,l,f,e,j,g,b,h,c,d);}}}function completarProveedor(a){$.get("../controllers/controlador.php?buscarProve",LLegadaCompletarProveedor);
}function LLegadaCompletarProveedor(data){for(var j=0;j<=prov.length;j++){$(".selectProvee"+prov[j]).html('<option value=""></option>');var json=eval("("+data+")");
for(i=0;i<json.length;i++){if(json[i].id==prov[j]){$(".selectProvee"+prov[j]).append('<option value="'+json[i].id+'" selected>'+json[i].nombre+"</option>");
}else{$(".selectProvee"+prov[j]).append('<option value="'+json[i].id+'">'+json[i].nombre+"</option>");}}}}function crearFila(a,m,n,h,g,l,j,b,k,d,e){$("#cprogramada").html($("#cantidadOP").val());
$("#cantidadOPI").val($("#cantidadOP").val());cantidadToral=(parseInt($("#cantidadOP").val()*parseInt(l)));costoTotal=parseFloat(b)*parseFloat(cantidadToral);
var f="";f+='<tr id="tr'+a+'" class="row-m">';f+='<td align="center">'+n+'<input type="hidden" name="idI[]" value="'+a+'"></td>';f+='<td align="center">'+h+'<input type="hidden" name="idFicha[]" value="'+d+'"></td>';
f+='<td align="center">'+j+'<input type="hidden" name="cantidad" value="'+l+'" /><input type="hidden" name="cantidad_und[]" /></td>';f+='<td align="center"><select class="selectProvee'+e+'"></select></td>';
f+='<td align="center">'+l+'<input type="hidden" name="costo_uni[]"  value="'+b+'"/></td>';f+='<td align="center">'+parseFloat(b)*parseFloat(l)+'<input type="hidden" name="costo[]" value="'+parseFloat(b)*parseFloat(l)+'" /></td>';
f+='<td align="center" class="bold">'+cantidadToral+'<input type="hidden" name="cantidadTotal[]" id="t'+a+'" value="'+cantidadToral+'" /></td>';f+='<td align="center" class="bold">'+costoTotal+"</td>";
f+='<td align="center">'+k+"</td>";if(parseInt(k)==0){f+='<td align="center" >';f+='<input type="text" style="width:110px" placeholder="Min '+cantidadToral+'" id= "s'+a+'"  onkeyUp="validarCantidadCampo(this.value,'+cantidadToral+","+a+')" class="accion" name="sol[]" onkeypress="return justNumbers(event);">';
f+=" </td>";f+='<td align="center">';f+='<input type="text" readonly placeholder="Max '+k+'" id= "i'+a+'"  style="width:110px"  class="accion" name="des[]" onkeypress="return justNumbers(event);">';
f+='      <td align="center" width="5%" id="v'+a+'"><img src="" width="22" height="22" id="im'+a+'"></td>';f+="</td></tr>";}else{var c=parseFloat(k)-parseFloat(cantidadToral);
if(c<0){c=c*(-1);}f+='<td align="center" >';f+='<input type="text" style="width:110px"   placeholder="Minimo '+c+'" class="accion" name="sol[]" id= "s'+a+'"  onkeyUp="validarCantidadCampo(this.value,'+c+","+a+')" onkeypress="return justNumbers(event);">';
f+=" </td>";f+='<td align="center">';f+='<input type="text" placeholder="Max '+k+'"  id= "i'+a+'" style="width:110px" class="accion" name="des[]" onkeypress="return justNumbers(event);calMin(this.value,'+cantidadToral+","+a+","+k+')">';
f+="</td>";f+='      <td align="center" width="5%" id="v'+a+'"><img src="" width="22" height="22" id="im'+a+'"></td></tr>';calMin(k,cantidadToral);}f+='<td align="center"></td>';
$("#"+m).append(f);}function imagenValidacion(a){if($("#i"+a).val()==""){num1=0;}else{num1=parseFloat($("#i"+a).val());}if($("#s"+a).val()==""){num2=0;
}else{num2=parseFloat($("#s"+a).val());}num3=parseFloat($("#t"+a).val());if(num1==""){num1=0;}if(num2==""){num2=0;}suma=num1+num2;console.log(num1);if(suma>=num3){$("#im"+a).attr("src","../../img/good.png");
}else{$("#im"+a).attr("src","../../img/erase.png");}if(num1==""&&num2==""){$("#im"+a).attr("src","");}}function maximo(b,c,a){if(parseInt(b)>parseInt(a)){b=b.substring(0,b.length-1);
$("#i"+c).val(b);}}function calMin(b,c,d,a){if(b==""){minimo=parseFloat(a)-parseFloat(c);if(minimo<0){minimo=minimo*(-1);}}else{minimo=parseFloat(c)-parseFloat(b);
}$("#s"+d).attr("placeholder","Minimo "+minimo);imagenValidacion(d);maximo(b,d,a);}function validarCantidadCampo(b,a,c){if(b<a&&b!=""){$("#s"+c).css("border","2px solid red");
}else{if(b>=a){$("#s"+c).css("border","2px solid #04B404");}else{if(b==""){$("#s"+c).css("border","1px solid #aaa");}}}imagenValidacion(c);}function validarCantidadCampoInv(b,a,c){if(b>a){$("#i"+c).css("border","2px solid red");
}else{if(b<=a&&b!=""){$("#i"+c).css("border","2px solid #04B404");}else{if(b==""){$("#i"+c).css("border","1px solid #aaa");}}}imagenValidacion(c);}function realizarPedidoI(a,c,b){$("#dialog #si").attr("onclick","siRealizarPedido('"+a+"','"+c+"','"+b+"')");
$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Realizar Pedido?').css("text-align","center");$("span.ui-dialog-title").text("Información importante").css("text-align","center");
$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");}function siRealizarPedido(a,c,b){$("#dialog").dialog("close");$("#cpedir").val(b);
console.log("orden de prod: "+a+" id insumo: "+c+" orden integracion "+$("#ordenI").val());$("#pordenp").val(a);$("#insumo").val(c);$("#integracion").val($("#ordenI").val());
$("span.ui-dialog-title").text("Cantidad a Pedir").css("text-align","center");$("#ventanaCantidad").dialog("open");}function llegadarealizarPedidoI(a){alertaAccion(a);
}function validarFechas(){inicio=$("#fecha_inicio").val();fin=$("#fecha_fin").val();if(fin<=inicio){alertaAccion("Verifique las Fechas");}else{mensajeConfirmacionEnvioOrden();
}return false;}function mensajeConfirmacionEnvioOrden(){$("#dialog #si").attr("onclick","enviarOrdenProduccion()");$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Crear Orden de Producción?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");
return false;}function enviarOrdenProduccion(){$("#dialog").dialog("close");$(".modalLoad").fadeIn();data=$("#produccion_enviar").serialize();$.get("../controllers/controlador.php?agregarOrdenProd&"+data,llegadaEnviarOrdenProduccion);
}function llegadaEnviarOrdenProduccion(a){if(a=="error en la consulta"){alertaAccion("Error al realizar el registro");}else{alertaAccion("Registro Exitoso");
buscarInsumosFicha($("#ficha").val());$("#OrdenProduccion").fadeOut();$(".modalLoad").fadeOut();}}function buscarInsumosFicha(a){$.get("../controllers/controlador.php?buscarFicha="+a,llegadaEnviarordenP);
}function llegadaEnviarordenP(data){var json=eval("("+data+")");$("#ordenpr").html($("#ordenP").val());$("#ordenpro").val($("#ordenP").val());for(i=0;i<json.length;
i++){crearTabla(json[i].id,json[i].categoria,json[i].codigo,json[i].descr,json[i].present,json[i].consumo,json[i].unidad,json[i].costo,json[i].cantidad,json[i].id_ficha,json[i].proveedor);
prov[i]=json[i].proveedor;}completarProveedor();$.get("../controllers/controlador.php?buscarOrdenIntegracion",llegadaBuscarOrdenIntegracion);$("#OrdenIntegracion").fadeIn();
}function llegadaBuscarOrdenIntegracion(data){var json=eval("("+data+")");if(json==""){$("#ordenP").val("0001");$("#nordenP").html("0001");}else{$("#ordenI").val(json);
$("#nordenI").html(json);}enviarOrdenIntegracion();}function preguntaEliminarOrdenProduccion(a){$("#dialog #si").attr("onclick","EliminarOrdenProduccion('"+a+"')");
$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Eliminar Esta orden de Producción?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");
}function EliminarOrdenProduccion(a){$("#"+a).fadeOut();$.get("../controllers/controlador.php?eliminarOrdenProduccion&id="+a,llegadaEliminarorden);}function llegadaEliminarorden(a){$("#dialog").dialog("close");
if(a=="error en la consulta"){alertaAccion("Error al realizar el registro");}else{alertaAccion("Registro Exitoso");}}function enviarOrdenIntegracion(){if($("#modificarInsumosFicha").val()=="si"){data=$("#modificarIntegracion").serialize();
$.get("../controllers/controlador.php?modificarOrdenIntegracion&"+data,llegadaModificarIntegracion);}else{data=$("#guardarIntegracion").serialize();$.get("../controllers/controlador.php?guardarOrdenIntegracion&"+data,llegadaRegistrarIntegracion);
}return false;}function llegadaModificarIntegracion(a){}function llegadaRegistrarIntegracion(a){$("#dialog").dialog("close");$("#guardarIntegracion #ok").attr("disabled","disabled");
alertaAccion("Registro Exitoso");}function verificarExistencia(a){$.get("../controllers/controlador.php?verificarExisteOrden&orden_pro="+a,llegadaVerificarExistencia);
}function llegadaVerificarExistencia(a){if(a=="Operación no válida, existe orden de Integración"){alertaAccion(a);}else{editarOrdPro("../controllers/editarOrden_produccion.php?id="+a);
}}function validarFechas2(){inicio=$("#fecha_inicio").val();fin=$("#fecha_fin").val();if(fin<=inicio){alertaAccion("Verifique las Fechas");}else{mensajeConfirmacionModOrden();
}return false;}function mensajeConfirmacionModOrden(){$("#dialog #si").attr("onclick","enviarOrdenModificarPro()");$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> Modificar Orden de Producción?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");
return false;}function enviarOrdenModificarPro(){$("#dialog").dialog("close");$(".modalLoad").fadeIn();data=$("#modificarOrdenP").serialize();$.get("../controllers/controlador.php?modificarOrdenProd&"+data,llegadaModificarOrdenProduccion);
return false;}function llegadaModificarOrdenProduccion(a){if(a=="error en la consulta"){alertaAccion("Error al realizar el registro");}else{alertaAccion("Registro Exitoso");
$(".modalLoad").fadeOut();}}function validarCheck(){var a=0;$("span.ui-dialog-title").text("Resumen del Pedido").css("text-align","center");$("#solicitud").dialog("open");
}function llegadaEnviarordenPSol(data){var json=eval("("+data+")");$("#ordenpr").html($("#ordenP").val());$("#ordenpro").val($("#ordenP").val());for(i=0;
i<json.length;i++){crearTablaSol(json[i].id,json[i].categoria,json[i].codigo,json[i].descr,json[i].present,json[i].consumo,json[i].unidad,json[i].costo,json[i].cantidad,json[i].id_ficha,json[i].proveedor,json[i].prove);
}$("span.ui-dialog-title").text("Pedidos").css("text-align","center");$("#solicitud").dialog("open");}function crearTablaSol(a,l,m,g,f,k,h,c,j,d,e,b){if(e!=undefined){elem=document.getElementById(e);
if(elem==null){var n="";n+='<div><table id="'+e+'" width="90%"  border="1" cellspacing="0">';n+="		<tr>";n+='		<td colspan="5" align="center" class="subtitle"><strong>'+b+"</strong></td>";
n+="		</tr>";n+='		<tr class="stittle">';n+='		<td align="center" width="10%">Código</td>';n+='      <td align="center" width="10%">Descripción</td>';n+='      <td align="center" width="5%">Inventario</td>';
n+='      <td align="center" width="5%"></td>';n+='      <td align="center" width="5%"></td>';$("#tablasol").append(n);crearFilaSol(a,l,m,g,f,k,h,c,j,d,e,b);
}else{crearFilaSol(a,l,m,g,f,k,h,c,j,d,e,b);}}}function crearFilaSol(a,m,n,h,g,l,j,c,k,d,e,b){var f="";f+='<tr id="tr'+a+'" class="row-m">';f+='<td align="center">'+n+'<input type="hidden" name="idI[]" value="'+a+'"></td>';
f+='<td align="center">'+h+'<input type="hidden" name="idFicha[]" value="'+d+'"></td>';f+='<td align="center">'+k+"</td>";f+='<td align="center"></td><td align="center"></td</tr>';
$("#"+e).append(f);}