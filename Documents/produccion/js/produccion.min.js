$(document).on("ready",function(){buscarOrden();mensaje();ventanaCostos();dialogoAlert();$("#procesos_enviar").on("submit",Costos);$("#enviarTodo").on("submit",enviarProduccion);
$("#modificarFicha").on("submit",preguntaModificar);nobackbutton();$.datepicker.setDefaults({changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd",dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero de","Febrero de","Marzo de","Abril de","Mayo de","Junio de","Julio de","Agosto de","Septiembre de","Octubre de","Noviembre de","Diciembre de"],nextText:"Siguiente",prevText:"Anterior"});
$(".calinput").datepicker();});function mostrar(b){var a=window.open(b,"","width=800,height=400");window.win=a;a.moveTo(0,0);a.resizeTo(screen.width,screen.height);
}function imprimir_esto(a){$("#"+a).printThis({debug:false,importCSS:true,printContainer:true,loadCSS:"../../css/style-print.css",pageTitle:"",removeInline:false,removebuttons:true,encabezadoAganda:true,});
}function noAccion(){$("#dialog").dialog("close");$("#dialogNotas").dialog("close");}function justNumbers(a){var b=window.event?window.event.keyCode:a.which;
if((b==8)||(b==46)){return true;}return/\d/.test(String.fromCharCode(b));}function NumCheck(b,a){key=b.keyCode?b.keyCode:b.which;if(key==8){return true;
}if(key>47&&key<58){if(a.value==""){return true;}regexp=/.[0-9]{5}$/;return !(regexp.test(a.value));}if(key==46){if(a.value==""){return false;}regexp=/^[0-9]+$/;
return regexp.test(a.value);}return false;}function removerCosto(a){padre=a.parentNode;padre=padre.parentNode;padre=padre.parentNode;hijo=padre.childNodes[0];
padre.removeChild(hijo);sumar();}function removerChild(c,b,a){elem=document.getElementById(c);padre=elem.parentNode;padre.removeChild(elem);costoTotalProximado(b);
costoTotalProximadoP();costoTotalProximadoInsumos();$("#i"+a).fadeIn();}function eliminarInsumo(c,b,a){$("#dialog #si").attr("onclick","removerChildInsumo('"+c+"','"+b+"', "+a+")");
$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Eliminar Insumo de Ficha Técnica?').css("text-align","center");$("span.ui-dialog-title").text("Información importante").css("text-align","center");
$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");}function removerChildInsumo(c,b,a){$(".modalLoad").fadeIn();removerChild(c,b,a);
$("#dialog").dialog("close");sumarOtrosCostosModifica($("#otrosCostos").val());$("#modificarFicha").append('<input type="hidden" name="Ieliminar[]" value="'+a+'">');
$(".modalLoad").fadeOut();}function llegadaEliminarInsumo(a){$(".modalLoad").fadeOut();if(a=="error en la consulta"){alertaAccion("Error al realizar el registro");
}else{alertaAccion("Registro Exitoso");}}function eliminarproceso(c,a,b){$("#dialog #si").attr("onclick","removerChildProceso('"+c+"','"+a+"','"+b+"')");
$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Eliminar Proceso de Ficha Técnica?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");
}function removerChildProceso(c,a,b){$(".modalLoad").fadeIn();$("#pr"+a).fadeIn();elem=document.getElementById(c);padre=elem.parentNode;padre.removeChild(elem);
$("#dialog").dialog("close");costoTotalProximadoPModificar();$("#modificarFicha").append('<input type="hidden" name="Peliminar[]" value="'+b+'">');$(".modalLoad").fadeOut();
}function removerChildP(c,a,b){$("#pr"+a).fadeIn();elem=document.getElementById(c);padre=elem.parentNode;padre.removeChild(elem);costoTotalProximado(tipo);
costoTotalProximadoP();costoTotalProximadoInsumos();}function nobackbutton(){window.location.hash="no-back-button";window.location.hash="Again-No-back-button";
window.onhashchange=function(){window.location.hash="no-back-button";};}function dialogoAlert(){$(function(){var a=400;$("#dialog").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});
});}function mensaje(){$(function(){var a=700;$("#error").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});
});}function ventanaCostos(){$(function(){var a=500;$("#ventanaCostos").dialog({autoOpen:false,width:a,height:"auto",show:{effect:"explode"},hide:{effect:"explode"},toolbar:false,close:function(){},});
});}function alertaAccion(a){$("#error").html("&nbsp;&nbsp;&nbsp;"+a).css("text-align","center");$("#error").prepend('<img id="theImg2" src="../../img/good.png" width="40" height="40"/> ');
$("span.ui-dialog-title").text("Información Importante").css("text-align","center");$("#error").dialog("open");setTimeout(function(){$("#error").dialog("close");
},2000);}function alertaAcc(a){$("#error").html("&nbsp;&nbsp;&nbsp;"+a).css("text-align","center");$("#error").prepend('<img id="theImg2" src="../../img/good.png" width="40" height="40"/> ');
$("span.ui-dialog-title").text("Información Importante").css("text-align","center");$("#error").dialog("open");setTimeout(function(){$("#error").dialog("close");
},2000);}function buscarOrden(){$.get("../controllers/controlador.php?buscarOrden",llegadaBuscarOrden);}function llegadaBuscarOrden(data){var json=eval("("+data+")");
for(i=0;i<json.length;i++){if(json[i].orden==null){$("#orden").val("10001");$("#norden").html("10001");}else{$("#orden").val(parseInt(json[i].orden)+1);
$("#norden").html(parseInt(json[i].orden)+1);}}}function enviarTodoFicha(){data1=$("#procesos_enviar").serialize();data2=$("#enviarTodo").serialize();$(".modalLoad").fadeIn();
$.get('../controllers/controlador.php?enviarProduccion="enviar"&'+data1+"&"+data2,llegadaenviarProduccion);}function enviarProduccion(){data1=$("#procesos_enviar").serialize();
data2=$("#enviarTodo").serialize();$(".modalLoad").fadeIn();$.get('../controllers/controlador.php?enviarProduccion="enviar"&'+data1+"&"+data2,llegadaenviarProduccion);
return false;}function llegadaenviarProduccion(a){console.log(a);$(".modalLoad").fadeOut();if(a=="error en la consulta"){alertaAccion("Error al realizar el registro");
}else{buscarOrden();alertaAccion("Registro Exitoso");$(".ventanaCostos").fadeOut();window.setTimeout("location.reload()",3000);}}function autocompletarProveedor(){$.get("../controllers/controlador.php?buscarProve",LLegadaAutocompletarProveedor);
}function LLegadaAutocompletarProveedor(data){$(".selectProveedor").html('<option value=""></option>');var json=eval("("+data+")");for(i=0;i<json.length;
i++){$(".selectProveedor").append('<option value="'+json[i].id+'">'+json[i].nombre+"</option>");}}function formato_numero(b,a,e,d){b=parseFloat(b);if(isNaN(b)){return"";
}if(a!==undefined){b=b.toFixed(a);}b=b.toString().replace(".",e!==undefined?e:",");if(d){var c=new RegExp("(-?[0-9]+)([0-9]{3})");while(c.test(b)){b=b.replace(c,"$1"+d+"$2");
}}return b;}function Costos(){$("#CoPredefinidos").html("");var a="<table width='100%'>";controles=document.getElementsByTagName("input");TotalCostoApx=0;
for(i=0;i<controles.length;i++){if(controles[i].className=="costaLC"){if(controles[i].value==""){numero=0;}else{numero=controles[i].value;}a+="<tr class='row-m'>";
a+="<td width='70%'>Costo "+controles[i+1].value+" $ </td>";a+="<td class='bold' align='center' width='80%'>"+formato_numero(controles[i].value,2,".",".")+"</td>";
a+="</tr>";TotalCostoApx=parseFloat(numero)+parseFloat(TotalCostoApx);}}a+="</table>";controles=document.getElementsByTagName("input");TotalCostoApx=0;
for(i=0;i<controles.length;i++){if(controles[i].className=="ostrosC"){if(controles[i].value==""){numero=0;}else{numero=controles[i].value;}TotalCostoApx=parseFloat(numero)+parseFloat(TotalCostoApx);
}}$("#otrosCostos").val("0");costoref=parseFloat($("#costotoli").val())+parseFloat($("#totalProceso").val()+parseFloat(TotalCostoApx));$("#totalref").val(costoref);
$("#subtotal").html(formato_numero(costoref,2,".","."));$("#CoPredefinidos").append(a);$("#CostoFinal").val(costoref);$("#total").html(formato_numero(costoref,2,".","."));
$("span.ui-dialog-title").text("Resumen de Costos").css("text-align","center");$("#ventanaCostos").dialog("open");return false;}function sumarOtrosCostos(a){controles=document.getElementsByTagName("input");
TotalCostoApx=0;for(i=0;i<controles.length;i++){if(controles[i].className=="ostrosC"){if(controles[i].value==""){numero=0;}else{numero=controles[i].value;
}TotalCostoApx=parseFloat(numero)+parseFloat(TotalCostoApx);}}if(a==""){a=0;$("#totalref").val(parseFloat($("#costotoli").val())+parseFloat($("#totalProceso").val()));
}dato=parseFloat($("#costotoli").val())+parseFloat($("#totalProceso").val()+parseFloat($(".ostrosC").val()));total=parseFloat(dato)+parseFloat(a)+parseFloat(TotalCostoApx);
$("#totalref").val(total);$("#subtotal").html(formato_numero(total,2,".","."));if($("#margenContri").val()!=""){sumarMargen($("#margenContri").val());}else{$("#CostoFinal").val(total);
}}function sumar(){controles=document.getElementsByTagName("input");TotalCostoApx=0;for(i=0;i<controles.length;i++){if(controles[i].className=="ostrosC"){if(controles[i].value==""){numero=0;
}else{numero=controles[i].value;}TotalCostoApx=parseFloat(numero)+parseFloat(TotalCostoApx);}}dato=parseFloat($("#costotoli").val())+parseFloat($("#totalProceso").val());
total=parseFloat(dato)+parseFloat(TotalCostoApx)+parseFloat($("#otrosCostos").val());$("#totalref").val(total);$("#subtotal").html(formato_numero(total,2,".","."));
if($("#margenContri").val()!=""){sumarMargen($("#margenContri").val());}else{$("#CostoFinal").val(total);}}function sumarOtrosCostosModifica(a){if(a==""){a=0;
}controles=document.getElementsByTagName("input");dato=0;for(i=0;i<controles.length;i++){if(controles[i].className=="cmod"){numero=controles[i].value;dato=parseInt(numero)+parseInt(dato);
}}total=parseFloat(dato)+parseFloat(a);$("#totalref").val(total);$("#subtotal").html(formato_numero(total,2,".","."));if($("#margenContri").val()!=""){sumarMargen($("#margenContri").val());
}else{$("#CostoFinal").val(total);}}function sumarMargen(a){if(a==""){a=0;}valor=(parseFloat($("#totalref").val()*a)/100);total=parseFloat($("#totalref").val())+parseFloat(valor);
console.log(valor);$("#utilidad").val(valor);$("#CostoFinal").val(total);$("#total").html(formato_numero(total,2,".","."));}function eliminarF(a){$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Eliminar Ficha Técnica?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #si").attr("onclick","siEliminarF("+a+")");
$("#dialog #no").attr("onclick","noAccion()");}function siEliminarF(a){$("#"+a).fadeOut();$.get("controllers/controlador.php?eliminarFicha&id="+a,llegadaSiEliminarFicha);
}function llegadaSiEliminarFicha(a){$("#dialog").dialog("close");if(a=="error en la consulta"){alertaAcc("Error al realizar el registro");}else{alertaAcc("Registro Exitoso");
}}function preguntaModificar(){$("#dialog #si").attr("onclick","ModificarFicha()");$("#dialog #mensaje").html('<img src="../../img/warning.png" width="36" height="36"/> ¿Guardar Cambios?').css("text-align","center");
$("span.ui-dialog-title").text("Información importante").css("text-align","center");$("#dialog").dialog("open");$("#dialog #no").attr("onclick","noAccion()");
}function ModificarFicha(){data=$("#modificarFicha").serialize();$.get("../controllers/controlador.php?modificarFicha&"+data,llegadaModificarFicha);return false;
}function llegadaModificarFicha(a){alertaAcc("Registro Exitoso");$("#dialog").dialog("close");}function agragarOtrosC(){dato=" <table width='100%'>";dato+="    <tr class='row-m'>";
dato+="      <td width='70%'><input type='text' style='width:80%;border:0px solid #fff; text-align:left;' name='desCO[]' class='ostrosC' required/> $</td>";
dato+="      <td class='bold' align='center' width='80%' ><input name='cosCO[]' onkeyup='sumar(this.value)'' onkeypress='return justNumbers(event);' type='text' value='0' class='ostrosC' required><img src='../../img/erase.png' height='22' width='22' onclick='removerCosto(this)'></td>";
dato+="    </tr> ";dato+="  </table> ";$("#agragarOtroCosto").append(dato);}